<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Leaderboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/leaderboard.css') }}"
    />
  </head>
  <body>
    <div class="wrap">
      <div class="row">
        <h1>Leaderboard</h1>
        <div
          style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap"
        >
          {% if back_round_id %}
          <a
            class="btn btn-ghost"
            href="{{url_for('play_round', round_id=back_round_id)}}"
            >Back to round</a
          >
          {% endif %}
          <a class="btn btn-ghost" href="{{url_for('host')}}">Back to host</a>
        </div>
      </div>

      <div class="card">
        <h3 style="margin: 0 0 10px 0">Total scores</h3>
        {% if not ranked %}
        <p class="muted">No players.</p>
        {% else %}
        <table>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Total</th>
          </tr>
          {% for (p, s) in ranked %}
          <tr>
            <td>{{loop.index}}</td>
            <td>{{p}}</td>
            <td>{{s}}</td>
          </tr>
          {% endfor %}
        </table>
        {% endif %}
        <p class="muted" style="margin: 10px 0 0 0">
          Scoring is normalized by map size
        </p>
      </div>

      <div class="card">
        <h3 style="margin: 0 0 10px 0">Round breakdown</h3>
        {% if not rounds %}
        <p class="muted">
          No rounds scored yet (did you set answers and submit guesses?).
        </p>
        {% else %} {% for rd in rounds %}
        <h4 style="margin: 10px 0 8px 0">
          Round {{rd.index}} — <code>{{rd.map}}</code>
        </h4>
        <div
          class="pinwrap"
          data-round="{{rd.index}}"
          data-answer-x="{{rd.answer[0]}}"
          data-answer-y="{{rd.answer[1]}}"
          style="position: relative; display: block; width: 100%"
        >
          <img class="pinmap" src="{{url_for('uploads', filename=rd.map)}}" />
          <svg
            class="pinsvg"
            style="position: absolute; inset: 0; width: 100%; height: 100%"
          ></svg>
          <div
            class="pintooltip"
            style="
              position: absolute;
              display: none;
              z-index: 5;
              padding: 6px 8px;
              border-radius: 10px;
              background: var(--card);
              border: 1px solid var(--border);
              color: var(--text);
              font-size: 12px;
              font-weight: 950;
              box-shadow: 0 6px 20px rgba(16, 24, 40, 0.12);
              pointer-events: none;
            "
          ></div>
        </div>
        <script
          type="application/json"
          class="pindata"
          data-round="{{rd.index}}"
        >
          {{ rd.guesses | tojson }}
        </script>
        <table style="margin-top: 10px">
          <tr>
            <th>Player</th>
            <th>Score</th>
            <th>Distance (px)</th>
          </tr>
          {% for p in players %} {% set v = rd.scores[p] %}
          <tr>
            <td>{{p}}</td>
            {% if v %}
            <td>{{v[0]}}</td>
            <td>{{v[1]}}</td>
            {% else %}
            <td class="muted">—</td>
            <td class="muted">no guess</td>
            {% endif %}
          </tr>
          {% endfor %}
        </table>
        {% endfor %} {% endif %}
      </div>

      <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
      <script src="{{ url_for('static', filename='js/leaderboard.js') }}"></script>
    </div>
  </body>
</html>
