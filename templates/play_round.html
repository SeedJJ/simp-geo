<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Play Round {{ round_num }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/play_round.css') }}"
    />
  </head>
  <body data-round-id="{{ round_id }}">
    <div class="scene" id="scene">
      {% if scene_fn %}
      <img
        id="sceneImg"
        src="{{ url_for('uploads', filename=scene_fn) }}"
        alt="Scene"
      />
      {% else %}
      <div class="scenePlaceholder">
        <div class="muted" style="font-weight: 950">No scene image uploaded</div>
        <div class="muted" style="font-size: 12px; margin-top: 6px">
          Host can upload one in the Host panel → Rounds.
        </div>
      </div>
      {% endif %}

      <!-- Minimap (drag/zoom/click to place pins) -->
      <div class="stage minimap" id="stage" aria-label="Minimap">
        <div id="mapLayer">
          <img id="mapImg" src="{{url_for('uploads', filename=map_fn)}}" alt="Map" />
        </div>
        <svg id="overlay" class="overlay"></svg>
      </div>
    </div>

    <div class="hud">
      <div class="group">
        <span class="roundTitle"
          >Round {{ round_num }} / {{ total_rounds }}</span
        >

        {% if prev_round_id %}
        <a
          class="navbtn"
          href="{{ url_for('play_round', round_id=prev_round_id) }}"
          >← Prev</a
        >
        {% else %}
        <span class="navbtn disabled">← Prev</span>
        {% endif %} {% if next_round_id %}
        <a
          class="navbtn"
          href="{{ url_for('play_round', round_id=next_round_id) }}"
          >Next →</a
        >
        {% else %}
        <span class="navbtn disabled">Next →</span>
        {% endif %}
      </div>

      <div class="group">
        <label for="player">Player</label>
        <select id="player"></select>
        <span class="pill" id="guessedPill">Guessed: 0 / 0</span>
        <span class="pill" id="pinStatus">Pin: —</span>
      </div>

      <div class="group">
        <button class="btn-ghost" id="zoomOut" title="Zoom out">−</button>
        <button class="btn-ghost" id="zoomIn" title="Zoom in">+</button>
        <button class="btn-ghost" id="resetView" title="Reset view">
          Reset
        </button>
        <span class="pill" id="zoomPill">100%</span>
      </div>

      <div class="group">
        <form
          id="addPlayerForm"
          style="display: flex; gap: 8px; align-items: center; margin: 0"
        >
          <input id="newPlayer" placeholder="Add player…" />
          <button type="submit">Add</button>
        </form>
      </div>

      <div class="spacer"></div>

      <div class="group">
        <a href="{{url_for('leaderboard')}}">Leaderboard</a>
        <a href="{{url_for('host')}}">Host</a>
      </div>
    </div>

    <div class="hint">
      <div class="chip">
        Use the minimap: drag to pan · wheel/buttons to zoom · click (no drag)
        to place pin
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/play_round.js') }}"></script>
  </body>
</html>
